<h3>お気に入りしている投稿</h3>

<div class="col-xs-11 col-sm-6 col-md-6 col-lg-4">
    
<div><canvas id="myChart" class="chart-container" style="position: relative;  width:60vw; height:60vh"></div>

</div>

<form name="formtop" id="quantity">
<% @user.liked_posts.each_with_index do |post, i| %>
<tr>
  <td><%=link_to(post.rname,"/posts/#{post.id}")%></td>
<br>
  <td><%= image_tag post.rimage.to_s %></td>
  
    <input type="number" step="0.01"  name="contents" value= 1 >
    
  
    <span id="<%= i %>" ></span>
</tr>
<br>

<br>
<% end %>
</form>
<script>

posts = gon.posts
console.log(`posts: ${JSON.stringify(posts)}`)
pn_ratio =  {
  Energy: '0',
  Protein: '0',
  Lipid: '0',
  Carbohydrate: '0',
  Dietary_fiber: '0',
  Potassium: '0',
  Calcium: '0',
  iron: '0',
  Zinc: '0',
  VitaminA: '0',
  VitaminB1: '0',
  VitaminB2: '0',
  VitaminC: '0',
  Salt_equivalent: '0'       
};


 pn_keys = Object.keys(pn_ratio)
 console.log(`pn_keys: ${JSON.stringify(pn_keys)}`)

 console.log(`gon.std: ${gon.std}`)
 std = gon.std
 console.log(`std: ${std}`)

 sum_nutrients  =  {
  Energy: '0',
  Protein: '0',
  Lipid: '0',
  Carbohydrate: '0',
  Dietary_fiber: '0',
  Potassium: '0',
  Calcium: '0',
  iron: '0',
  Zinc: '0',
  VitaminA: '0',
  VitaminB1: '0',
  VitaminB2: '0',
  VitaminC: '0',
  Salt_equivalent: '0'       
 };

 var formObject = document.getElementById( "quantity" );
 console.log(`quantity: ${JSON.stringify(quantity)}`)




window.onload = function () {
  


    var formObject = document.getElementById( "quantity" );
    console.log(`quantity: ${JSON.stringify(quantity)}`)

    for( var x = 0; x < formObject.length; x++ ) {
        formObject.elements[i].onkeyup = function(){
          var formObject = document.getElementById( "quantity" );
         
          console.log(`quantity: ${JSON.stringify(quantity)}`)



          document.getElementById( "x" ).innerHTML = formObject.contents.value;
          var quantity = formObject.contents.value;
        };
        formObject.elements[i].onchange = function(){
          var formObject = document.getElementById( "quantity" );
          document.getElementById( "x" ).innerHTML = formObject.contents.value;
          var quantity = formObject.contents.value;
        };
    }


     
    

      
      for(let l in posts) {
        console.log(`i: ${i}`)
        console.log(`posts[l]: ${JSON.stringify(posts[l])}`)
        let post = posts[l];
        console.log(`post: ${JSON.stringify(post)}`)

        for (let i = 0; i < 14; i++){
          console.log(`sum_nutrients: ${JSON.stringify(sum_nutrients)}`)
          console.log(`i: ${i}`)
          let pn_key = pn_keys[i]
          console.log(`pn_key: ${pn_key}`)
          let num1 = parseFloat(sum_nutrients[pn_key])
          let num2 = parseFloat(post[pn_key])
          let num3 = parseFloat(quantity)
          if (Number.isNaN(num2)) {num2 = 0}
          if (num3 < 0.01 || 1000 < num3  ) {num3 = 1}
          else{
                    num2 = num2 * num3
                    console.log(`num2x: ${JSON.stringify(num2)}`)
          }
          console.log(`num1: ${JSON.stringify(num1)}`)
          console.log(`num2: ${JSON.stringify(num2)}`)
          sum_nutrients[sn_key] = num1 + num2;
           console.log(`sum_nutrients[pn_key]: ${JSON.stringify(sum_nutrients[pn_key])}`)
        }
     }
   
 

      for (var i = 0; i < 14; i++){

        var pn_key = pn_keys[i]
        var std_key = 'x' + pn_key
        console.log(`pn_key: ${pn_key}`)
        console.log(`std_key: ${std_key}`)
        console.log(`std: ${std}`)
        var num1 = parseFloat(sum_nutrients[pn_key])
        var num2 = parseFloat(std[std_key])
        console.log(`num1: ${JSON.stringify(num1)}`)
        console.log(`num2: ${JSON.stringify(num2)}`)
        pn_ratio[pn_key] = num1 / num2 * 100;
         console.log(`pn_ratio[pn_key]: ${JSON.stringify(pn_ratio[pn_key])}`)


        
        if (pn_ratio[pn_key] === null || pn_ratio[pn_key] < 0) {
          pn_ratio[pn_key] = 0
        }else if(pn_ratio[pn_key] > 150){
          pn_ratio[pn_key] = 150
        }


      }
      var ctx = document.getElementById("myChart");
      var myChart = new Chart(ctx, {
        type: 'radar',
        data: {
          labels: ["エネルギー", "タンパク質", "脂質", "糖質", "食物繊維", "カリウム", "カルシウム", "鉄", "亜鉛", "ビタミンA", "ビタミンB1", "ビタミンB2", "ビタミンC", "食塩相当量"],
          datasets: [{
            label: '摂取基準',
            backgroundColor: "rgba(0,0,80,0.4)",
            borderColor: "rgba(0,0,80,1)",
            data: [100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100]
          }, {
            label: 'レシピの栄養比率',
            backgroundColor: "rgba(0,255,0,0.4)",
            borderColor: "rgba(0,255,0,1)",
            data: [pn_ratio.Energy, pn_ratio.Protein, pn_ratio.Lipid, pn_ratio.Carbohydrate, pn_ratio.Dietary_fiber, pn_ratio.Potassium, pn_ratio.Calcium, pn_ratio.iron, pn_ratio.Zinc, pn_ratio.VitaminA, pn_ratio.VitaminB1, pn_ratio.VitaminB2, pn_ratio.VitaminC, pn_ratio.Salt_equivalent]
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scale: {
            
                Min: 0,
                Max: 120
            
          }
        }
      });

}


</script>
